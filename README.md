# Digital Airlines
Παναγιώτης Γιαννακόπουλος (e20026)

Η υπηρεσία αυτή είναι υπεύθυνη για την κράτηση εισητηρίων της εταιρείας Digital Airlines. Υποστηρίζει λειτουργίες όπως αυθεντικοποίηση, προσθήκη, επεξεργασία και διαγραφή πτήσεων και κρατήσεων. Οι λειτουργίες αυτές μπορούν να γίνουν από τον browser και από το Postman.


## Πως να τρέξετε την υπηρεσία

Η υπηρεσία αυτή χρησιμοποιεί το Docker, το Flask ως server και την MongoDB ως βάση δεδομένων. Έχει γίνει containerized χάρη στο docker-compose όυτως ώστε τα container του Flask και του MongoDB να τρέχουν ταυτόχρονα. 
Τα βήματα λοιπόν που πρέπει να τρέξει κάποιος για να χρησιμοποιήσει την υπηρεσία είναι τα εξής:
1. Ανοίγουμε το Git Bash και αλλάζουμε το τρέχον working directory στην τοποθεσία που θέλουμε να κλονοποιήσουμε το directory
    ```
    git init
    ```

2. Κλονοποιούμε το αποθετήριο

     ```
      git clone https://github.com/PanGian2/YpoxreotikiErgasia23_e20026_Giannakopoulos_Panagiotis.git
     ```
3. Κάνουμε compose up την υπηρεσία

   ```
    cd YpoxreotikiErgasia23_e20026_Giannakopoulos_Panagiotis
    docker-compose up -d
   ```
4. Όταν το τρέξουμε για πρώτη φόρα θα πρέπει να εισάγουμε μερικά δεδομένα στην βάση. Επομένως πηγαίνουμε στο αρχείο seeds.py το οποίο θα εισάγει μερικούς χρήστες και μία πτήση στην βάση.
     ```
      cd flask/data
      python seeds.py
     ```
5. Βεβαιωνόμαστε ότι το flask τρέχει κανονικά
   
   ```
    docker logs flask
   ```
   ![image](https://github.com/PanGian2/YpoxreotikiErgasia23_e20026_Giannakopoulos_Panagiotis/assets/122677298/a45604b5-31d1-45e3-bea1-c2a5178448ed)

6. Πηγαίνουμε στο browser και πληκτρολογούμε http://localhost:5000/ . Έτσι έχουμε μεταβέι στην αρχική σελίδα της υπηρεσίας και μπορούμε να προχωρήσουμε στια διάφορες λειτουργίες της
   
   ![image](https://github.com/PanGian2/YpoxreotikiErgasia23_e20026_Giannakopoulos_Panagiotis/assets/122677298/c92e4d65-48d3-4ba0-a43a-7aa6df48dccf)


## Λειτουργίες

Για να πλοηγηθεί ο χρήστης στην σελίδα είναι απαραίτητο να έχει συνδεθεί πρώτα

### Login

Ο χρήστης προκειμένου να πλοηγηθεί στην σελίδα πρέπει να συνδεθεί πρώτα. Επομένως πηγαίνει στο `/login`. Θα πρέπει να εισάγει το email και τον κωδικό του. Σε περίπτωση που δεν εισαχθεί κάποιο από τα δύο επιστρέφεται `Εrror 400 (Bad Request)`. Επίσης αν τα στοιχεία δεν αντιστοιχούν σε κάποιον χρήστη επιστρέφεται `Error 401 (Unauthorized)`. Όταν λοιπόν ο χρήστης εισάγει σωστά στοιχεία συνδέεται στο σύστημα. Για την διατήρηση της σύνδεσης χρησιμοποιούμε το session το οποιό είναι ένα cookie του οποίου το περιεχόμενο είναι κρυπτογραφημένο. Η τιμή του session είναι το username του χρήστη που συνδέθηκε μιας και αυτό είναι μοναδικό. Επίσης ορίζουμε ότι το session λήγει μετά από 5 λεπτά.

![image](https://github.com/PanGian2/YpoxreotikiErgasia23_e20026_Giannakopoulos_Panagiotis/assets/122677298/40dda9d1-93af-4c89-9729-51467417af99)

![image](https://github.com/PanGian2/YpoxreotikiErgasia23_e20026_Giannakopoulos_Panagiotis/assets/122677298/3c79723b-5cbc-4041-8c01-a57276d2ec1e)

Ο διαχωρισμός και η αυθεντικοποίηση των χρηστών γίνεται ως εξής. Σε κάθε εγγραφή υπάρχει ενα πεδίο `type` το οποίο παίρνει τιμές `User`, για τον απλό χρήστη, και `Admin`, για τον διαχειριστή. Επομένως για να δούμε αν κάποιος χρήστης είναι `User` παίρνουμε το username από το session και ελέγχουμε αν ο τύπος του είναι `User`. Αντίστοιχα για τους διαχειριστές, επειδή ξέρουμε ότι υπάρχουν μόνο δύο ελέγχουμε αν το username είναι admin1 ή admin2.

Oι κωδικοί για τους απλούς χρήστες είναι 123 ενώ για τους διαχειριστές είναι admin


### Registration

Όπως είπαμε είναι απαραίτητο ο χρήστης να έχει λογαριασμό. Επομένως στο `/register` καλείται να συμπληρώσει την φόρμα ώστε να φτιάξει λογαριασμό. Πρέπει να συμπληρώσει το username, password, email, πλήρες όνομα. ημερομηνία γέννησης, χώρα προέλευσης και διαβατήριο. Τα username και τα email είναι μοναδικά σε κάθε χρήστη οπότε σε περίπτωση που δώθεί κάποιο από τα δύο τα οποία βρίσκονται ήδη στο σύστημα επιστρέφεται `Error 400`. Διαφορετικά δημιουργείται ένας νέος χρήστης. Επειδή μόνο απλοί χρήστες μπορούν να φτιάξουν λογαριασμό, ορίζουμε το `type: "User"`

![image](https://github.com/PanGian2/YpoxreotikiErgasia23_e20026_Giannakopoulos_Panagiotis/assets/122677298/c8835425-e3b8-4064-85f9-ee6041e3a8dd)


### Logout

Δίνεται η δυνατότητα στους χρήστες να κάνουν logout από το σύστημα στο `/logout`. Απλά ένας συνδεδεμένος χρήστης πηγαίνει στο /logout και τότε ξεσυνδέεται. Σε περίπτωση που δεν είναι συνδεδεμένος απλά του λέει ότι δεν έχει γίνει σύνδεση

![image](https://github.com/PanGian2/YpoxreotikiErgasia23_e20026_Giannakopoulos_Panagiotis/assets/122677298/aa62db69-9810-4b52-a2f7-83c6c043dd59)


### Αναζήτηση Πτήσεων

Οι χρήστες μπορούν να αναζητήσουν όλες τις διαθέσιμες πτήσεις στο σύστημα στο `/flights`. Αυτό το endpoint είναι κοινό και για τους απλούς χρήστες και για τους διαχειριστές. Πληκτρολογώντας /flights, θα εμφανιστεί το id, το αεροδρόμιο αναχώρησης, το αεροδρόμιο προορισμού και η ημερομηνία όλων των διαθέσιμων πτήσεων.

![image](https://github.com/PanGian2/YpoxreotikiErgasia23_e20026_Giannakopoulos_Panagiotis/assets/122677298/c14ba56f-6e20-473e-aeed-06dc2bbb6748)

Επίσης δύναται η δυνατότητα φιλτραρίσματος των αποτελεσμάτων χρησιμοποιώντας ως arguments τα `departAirport` και `destAirport` μαζί, το `flightDate`, ή και τα τρία μαζί. 

Για παράδειγμα `http://localhost:5000/flights?departAirport=El. Benizelos (ATH)&destAirport=El Prat (BCN)`

![image](https://github.com/PanGian2/YpoxreotikiErgasia23_e20026_Giannakopoulos_Panagiotis/assets/122677298/375e7481-17a5-4af7-9942-53bcb73b763f)


### Αναζήτηση Συγκεκριμένης Πτήσης

Οι χρήστες μπορούν να λάβουν περισσότερες πληροφορίες για πτήση πηγαίνοντας στο `/flights/<id>` όπου id το id της πτήσης. Το endpoint είναι διαθέσιμο και στους δύο τύπους χρήστη αλλά τα αποτελέσματα ανά τύπο είναι διαφορετικά. Στους απλούς χρήστες εμφανίζεται η ημερομηνία διεξαγωγής της πτήσης, το αεροδρόμιο προέλευσης και το αεροδρόμιο τελικού προορισμού, τα διαθέσιμα εισιτήρια (economy και business), καθώς και το κόστος των εισιτηρίων για τη κάθε μία από τις δύο κατηγορίες (economy και business).

![image](https://github.com/PanGian2/YpoxreotikiErgasia23_e20026_Giannakopoulos_Panagiotis/assets/122677298/c1ed220c-3dd7-4881-b087-78869db090eb)

Από την άλλη στους διαχειριστές σε συνδυασμό με τα παραπάνω δεδομένα εμφανίζεται και το ονοματεπώνυμο το ατόμου για το οποίο έχει γίνει η κράτηση καθώς και η κατηγορία της θέσης που έχει κρατηθεί, για κάθε κράτηση που έχει γίνει στη πτήση αυτή.

![image](https://github.com/PanGian2/YpoxreotikiErgasia23_e20026_Giannakopoulos_Panagiotis/assets/122677298/7559a193-1111-46e4-b0f8-13291d18fcf2)


### Ενημέρωση πτήσης

Ένας διαχειριστής μπορεί να αλλάξει τις τιμές των εισητηρίων για τις κατηγορίες business & economy μιας συγκεκριμένης πτήσης. Για να το κάνει αυτό θα πρέπει να πάει στο `/flights/<id>` όπου id το id της πτήσης. Η συγκεκριμένη λειτουργία γίνεται με την μέθοδο `PUT`, μιας και θέλουμε να κάνουμε ενημέρωση μίας εγγραφής. Επομένως πρέπει να πάμε στο Postman και να θέσουμε τις τιμές των δύο κατηγοριών.

![image](https://github.com/PanGian2/YpoxreotikiErgasia23_e20026_Giannakopoulos_Panagiotis/assets/122677298/32f933eb-5549-4065-ba40-2e8cb2f786b6)

Στην περίπτωση που κάποιος απλός χρήστης προσπαθήσει να εισέλθει στο συγκεκριμένο endpoint βγαίνει `Error 403 Forbidden`


### Δημιουργία πτήσης

Ένας διαχειριστής μπορεί να δημιουργήσει μία νέα πτήση στο `/flights/new`. Θα πρέπει να συμπληρώσει την ημερομηνία διεξαγωγής της πτήσης, το αεροδρόμιο προέλευσης και το αεροδρόμιο τελικού προορισμού, τα διαθέσιμα εισιτήρια (economy και business), καθώς και το κόστος των εισιτηρίων για τη κάθε μία από τις δύο κατηγορίες (economy και business). Η μέθοδος αυτού του endpoint είναι το `POST` μιας και εισάγουμε μία νέα εγγραφή στην βάση.

![image](https://github.com/PanGian2/YpoxreotikiErgasia23_e20026_Giannakopoulos_Panagiotis/assets/122677298/812de017-aff3-4871-adc8-c9bc2de2c791)

![image](https://github.com/PanGian2/YpoxreotikiErgasia23_e20026_Giannakopoulos_Panagiotis/assets/122677298/139d269e-4d9b-49e2-9cb8-b9fbe251bd2b)

Στην περίπτωση που ο χρήστης εισάγει δεδομένα χαρακτήρα για κάποια από τα πεδία των ειητηρίων βγαίνει το αντίστοιχο μήνυμα λάθους, ότι πρέπει να ναι αριθμοί.


### Διαγραφή πτήσης

Ένας διαχειριστής μπορεί να διαγράψει μία πτήση στο `/flights/<id>` όπου id το id της πτήσης. Αυτό μπορεί να το κάνει στο Postman πηγαίνοντας στο `http://localhost:5000/flights/64943d40a1c64835299976e7` επιλέγοντας την μέθοδο `DELETE`. Έτσι έχουμε το εξής αποτέλεσμα

![image](https://github.com/PanGian2/YpoxreotikiErgasia23_e20026_Giannakopoulos_Panagiotis/assets/122677298/3ff3ba49-c1d6-4af5-b6ee-bcdf4550773a)

Απαραίτητη προυπόθεση για να διαγραφεί η πτήση, είναι να μην υπάρχουν κρατήσεις για αυτήν. Άμα υπάρχουν, τότε βγαίνει το κατάλληλο μήνυμα και η πτήση δεν διαγράφεται


### Αγορά εισητηρίου

Ένας απλός χρήστης μπορεί να αγοράσει ένα εισητήριο για μια συγκεκριμένη πτήση στο `/bookings/new/<flight_id>` όπου flight_id το id της πτήσης. Για να κάνει την κράτηση θα πρέπει να συμππληρώσει το ονοματεπώνυμο, τον αριθμό διαβατηρίου, την ημερομηνία γέννησης, το email και τον τύπο εισητρίου που θέλει να αγοράσει. Με την επιτυχή κράτηση, προσθέτονται στο εισητήριο το αεροδρόμιο αναχώρησης, το αεροδρόμιο προέλευσης, η ημερομηνία της πτήσης και το id αυτής. Επίσης ανανεώνονται οι διαθέσιμες θέσεις για αυτήν την πτήση. Είναι σημαντικό το email να είναι αυτό του χρήστη που έχει συνδεθεί και όχι κάποιο άλλο, ούτως ώστε να αποθηκευτεί η κράτηση στον λογαριασμό του συνδεδεμένου χρήστη.

Για παράδειγμα για την πτήση από Αθήνα προς Θεσσαλονική. Έχουμε 0 διαθέσιμα Business εισητήρια και 15 διαθέσιμα Economy εισητήρια. Τότε θα προκύψει το εξής:

![image](https://github.com/PanGian2/YpoxreotikiErgasia23_e20026_Giannakopoulos_Panagiotis/assets/122677298/396a820a-92b8-4504-9e82-4874d552d99f)

![image](https://github.com/PanGian2/YpoxreotikiErgasia23_e20026_Giannakopoulos_Panagiotis/assets/122677298/0deb7c75-ddc4-4b6a-8b32-ec8cb7fbeb0e)

Στην περίπτωση όμως που επιλέξουμε το Business, θα προκύψει λάθος αφού δεν υπάρχουν διαθέσιμα εισητήρια.

![image](https://github.com/PanGian2/YpoxreotikiErgasia23_e20026_Giannakopoulos_Panagiotis/assets/122677298/7ac1ef2b-24c8-4d60-9285-1383e57a8bd1)


### Αναζήτηση κρατήσεων

Ένας απλός χρήστης μπορεί να αναζητήσει όλες τις κρατήσεις που έχουν γίνει στον λογαριασμό του στο `/bookings`. Δηλαδή επιστρέφονται όλες οι κρατήσης των οποίων τα email ταυτίζονται με το email του συνδεδεμένου χρήστη.

![image](https://github.com/PanGian2/YpoxreotikiErgasia23_e20026_Giannakopoulos_Panagiotis/assets/122677298/21901048-c9f1-47d7-8f43-69f09fc0d5c4)


### Αναζήτηση συγκεκριμένης κράτησης

Ένας απλός χρήστης μπορεί να αναζητήσει μία συγκεκριμένη κρατήση που έχει γίνει στον λογαριασμό του στο `/bookings/<id>` όπου id το id της κράτησης. Και εδώ το email της κράτησης πρέπει να ταυτίζεται με το email του συνδεδεμέου χρήστη. 

![image](https://github.com/PanGian2/YpoxreotikiErgasia23_e20026_Giannakopoulos_Panagiotis/assets/122677298/02b6cd70-0a0b-491f-95c4-4db5ba4d820a)

### Ακύρωση κράτησης

Ένας απλός χρήστης μπορεί να ακυρώσει μία κράτηση που έχει γίνει στον λογαριασμό του στο `/bookings/<id>` όπου id το id της κράτησης. Για να γίνει αυτό θα πρέπει να πάμε στο Postman και να επιλέξουμε την μέθοδο `DELETE`. Για παράδειγμα πάμε στο `http://localhost:5000/bookings/64948cfe9c470bb075b1f8a3`. Με την επιτυχή διαγραφή ενημερώνονται και τα διαθέσιμα εισητήρια της πτήσης

![image](https://github.com/PanGian2/YpoxreotikiErgasia23_e20026_Giannakopoulos_Panagiotis/assets/122677298/a6d36751-e71f-4edd-8515-026a75c708e6)


### Διαγραφή χρήστη

Ένας απλός χρήστης μπορεί να διαγράψει τον λογαριασμό του στο `/user/delete`. Αρκεί να πάει στο Postman, να επιλέξει την μέθοδο DELETE και ο λογαριασμός του διαγράφεται.

![image](https://github.com/PanGian2/YpoxreotikiErgasia23_e20026_Giannakopoulos_Panagiotis/assets/122677298/f61f32b9-e473-4ea1-a91e-081e5c1adce6)

